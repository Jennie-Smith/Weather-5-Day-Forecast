<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css' rel='stylesheet'/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
        .geocoder {
            display: flex;
            width: 50%;
            left: 50%;
            margin-bottom: 1em;
            margin-left: 40%;
        }
    </style>
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
<div class="card">
    <!--  header-->
    <div class="card-header text-white bg-primary d-flex">
        <div>Five Day Weather Forecast</div>
    </div>
    <!--  Weather cards + map + search bar-->
    <div class="card-body">
        <div class="card-body d-flex">
            <div class="card m-auto" style="width: 10rem;">
                <div id="day1" class="card-header date">
                    Day 1
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp1" class="list-group-item">Weather degrees</li>
                    <li class="list-group-item">
                        <img id="image1" src="" alt="">
                    </li>
                    <li id="description1" class="list-group-item">humidity</li>
                    <li id="humidity1" class="list-group-item">humidity</li>
                    <li id="wind1" class="list-group-item">wind</li>
                    <li id="pressure1" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card m-auto" style="width: 10rem;">
                <div id="day2" class="card-header">
                    Day 2
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp2" class="list-group-item">Weather degrees + icon</li>
                    <li class="list-group-item">
                        <img id="image2" src="" alt="">
                    </li>
                    <li id="description2" class="list-group-item">humidity</li>
                    <li id="humidity2" class="list-group-item">humidity</li>
                    <li id="wind2" class="list-group-item">wind</li>
                    <li id="pressure2" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card m-auto" style="width: 10rem;">
                <div id="day3" class="card-header">
                    Day 3
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp3" class="list-group-item">Weather degrees + icon</li>
                    <li class="list-group-item">
                        <img id="image3" src="" alt="">
                    </li>
                    <li id="description3" class="list-group-item">humidity</li>
                    <li id="humidity3" class="list-group-item">humidity</li>
                    <li id="wind3" class="list-group-item">wind</li>
                    <li id="pressure3" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card m-auto" style="width: 10rem;">
                <div id="day4" class="card-header">
                    Day 4
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp4" class="list-group-item">Weather degrees + icon</li>
                    <li class="list-group-item">
                        <img id="image4" src="" alt="">
                    </li>
                    <li id="description4" class="list-group-item">humidity</li>
                    <li id="humidity4" class="list-group-item">humidity</li>
                    <li id="wind4" class="list-group-item">wind</li>
                    <li id="pressure4" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card m-auto" style="width: 10rem;">
                <div id="day5" class="card-header">
                    Day 5
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp5" class="list-group-item">Weather degrees + icon</li>
                    <li class="list-group-item">
                        <img id="image5" src="" alt="">
                    </li>
                    <li id="description5" class="list-group-item">humidity</li>
                    <li id="humidity5" class="list-group-item">humidity</li>
                    <li id="wind5" class="list-group-item">wind</li>
                    <li id="pressure5" class="list-group-item">pressure</li>
                </ul>
            </div>

        </div>
        <hr>
        <!--    map-->
        <div id="geocoder" class="geocoder"></div>
        <div id="map"></div>

    </div>
</div>


<script src="js/key.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js'></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {
        //map
        mapboxgl.accessToken = MAPBOX_API_KEY;
        const map = new mapboxgl.Map({
            container: 'map',
            style: "mapbox://styles/mapbox/outdoors-v12",
            zoom: 10,
            center: [-98.4916, 29.4252]
        });

        const geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl
        });

        document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

        function getCoordinates() {
            map.on('click', (e) => {
                let lat = e.lngLat.lat
                let lng = e.lngLat.lng
                let popup = new mapboxgl.Popup()
                    .setLngLat([lng, lat])
                    .setHTML(`lat = ${lat} lng = ${lng}`)
                const marker = new mapboxgl.Marker()
                    .setLngLat([lng, lat])
                    .addTo(map);
                popup.addTo(map);
                getWeather(lat, lng)
            });
        }
        getCoordinates()


        function getDate(dt){
            let utcSeconds = dt
            let date = new Date(utcSeconds*1000);
            let resultFormat = date.toISOString().split('T')[0]
            // return $('#day1').html(resultFormat);
            return resultFormat;
        }

        function getIcon(id){
            if (id > 800 && id < 805) {
                //clouds
                return "http://openweathermap.org/img/w/04d.png";
            } else if (id > 499 && id < 532){
                //rain
                return "http://openweathermap.org/img/w/10d.png";
            } else if (id > 199 && id < 233) {
                //thunderstorm
                return "http://openweathermap.org/img/w/11d.png"
            }
            else if (id > 299 && id < 322) {
                //drizzle
                return "http://openweathermap.org/img/w/09d.png"
            }
            else if (id > 599 && id < 623) {
                //snow
                return "http://openweathermap.org/img/w/13d.png"
            }else if (id > 699 && id < 782) {
                //atmosphere
                return "http://openweathermap.org/img/w/50d.png"
            }else if (id === 800) {
                //clear
                return "http://openweathermap.org/img/w/01d.png"
            }
        }


        function getWeather(mylat, mylon) {
            $.get("http://api.openweathermap.org/data/2.5/forecast", {
                APPID: OPENWEATHER_API_KEY,
                lat: mylat,
                lon: mylon,
                units: "imperial"
            }).done(function (data) {
                console.log('The entire response:', data);

                let formatedDate = getDate(data.list[0].dt)
                $('#day1').html(formatedDate);

                let formatedIcon = getIcon(data.list[0].weather[0].id);
                $('#image1').attr("src", formatedIcon)

                $('#temp1').html(`Temp: ${data.list[0].main.temp}\xB0`)
                $("#description1").html(data.list[0].weather[0].main)
                $('#humidity1').html(`Humidity: ${data.list[0].main.humidity}`)
                $('#wind1').html(`Wind Speed: ${data.list[0].wind.speed}`)
                $('#pressure1').html(`Pressure: ${data.list[0].main.pressure}`);

                //card 2
                formatedDate = getDate(data.list[8].dt)
                $('#day2').html(formatedDate);

                formatedIcon = getIcon(data.list[8].weather[0].id);
                $('#image2').attr("src", formatedIcon)

                $('#temp2').html(`Temp: ${data.list[8].main.temp}\xB0`)
                $("#description2").html(data.list[8].weather[0].main)
                $('#humidity2').html(`Humidity: ${data.list[8].main.humidity}`)
                $('#wind2').html(`Wind Speed: ${data.list[8].wind.speed}`)
                $('#pressure2').html(`Pressure: ${data.list[8].main.pressure}`);

                formatedDate = getDate(data.list[16].dt)
                $('#day3').html(formatedDate);

                formatedIcon = getIcon(data.list[16].weather[0].id);
                $('#image3').attr("src", formatedIcon)

                $('#temp3').html(`Temp: ${data.list[16].main.temp}\xB0`)
                $("#description3").html(data.list[16].weather[0].main)
                $('#humidity3').html(`Humidity: ${data.list[16].main.humidity}`)
                $('#wind3').html(`Wind Speed: ${data.list[16].wind.speed}`)
                $('#pressure3').html(`Pressure: ${data.list[16].main.pressure}`);

                formatedDate = getDate(data.list[24].dt)
                $('#day4').html(formatedDate);

                formatedIcon = getIcon(data.list[24].weather[0].id);
                $('#image4').attr("src", formatedIcon)

                $('#temp4').html(`Temp: ${data.list[24].main.temp}\xB0`)
                $("#description4").html(data.list[24].weather[0].main)
                $('#humidity4').html(`Humidity: ${data.list[24].main.humidity}`)
                $('#wind4').html(`Wind Speed: ${data.list[24].wind.speed}`)
                $('#pressure4').html(`Pressure: ${data.list[24].main.pressure}`);

                formatedDate = getDate(data.list[32].dt)
                $('#day5').html(formatedDate);

                formatedIcon = getIcon(data.list[32].weather[0].id);
                $('#image5').attr("src", formatedIcon)

                $('#temp5').html(`Temp: ${data.list[32].main.temp}\xB0`)
                $("#description5").html(data.list[32].weather[0].main)
                $('#humidity5').html(`Humidity: ${data.list[32].main.humidity}`)
                $('#wind5').html(`Wind Speed: ${data.list[32].wind.speed}`)
                $('#pressure5').html(`Pressure: ${data.list[32].main.pressure}`);

            });
        }

        getWeather(29.423017, -98.48527)


    });
</script>

</body>
</html>