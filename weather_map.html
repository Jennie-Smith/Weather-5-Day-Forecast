<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css' rel='stylesheet'/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@600&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Merriweather', serif;
        }
        .bgImage {
            background: url(image/wp5980872-pink-cloud-aesthetic-desktop-wallpapers.jpg);
            background-size: cover;
            color: white;
        }
        #map {
            width: 50%;
            height: 300px;
        }
        .pink {
            background-color: #FFC0CB;
            color: white;
        }
        .btn {
            margin-top: 1em;
        }
        .fixText {
            text-align: center;
        }
    </style>
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">

<audio id="wow" preload="auto">
    <source src="sound/anime-wow-effect.mp3" type="audio/mpeg">
</audio>

<div class="card">
    <!--  header-->
    <div class="card-header bgImage">
        <h1 class="fixText">Cutest Five-Day Forecast</h1>
    </div>
    <!--  Weather cards + map + search bar-->
    <div class="card-body">
        <div class="card-body d-flex">
            <div class="card fixText m-auto" style="width: 10rem;">
                <div id="day1" class="card-header pink date">
                    Day 1
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp1" class="list-group-item">Degrees</li>
                    <li class="list-group-item">
                        <img id="image1" src="" alt="">
                    </li>
                    <li id="description1" class="list-group-item">Weather</li>
                    <li id="humidity1" class="list-group-item">humidity</li>
                    <li id="wind1" class="list-group-item">wind</li>
                    <li id="pressure1" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card fixText m-auto" style="width: 10rem;">
                <div id="day2" class="card-header bgImage">
                    Day 2
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp2" class="list-group-item">Degrees</li>
                    <li class="list-group-item">
                        <img id="image2" src="" alt="">
                    </li>
                    <li id="description2" class="list-group-item">Weather</li>
                    <li id="humidity2" class="list-group-item">humidity</li>
                    <li id="wind2" class="list-group-item">wind</li>
                    <li id="pressure2" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card fixText m-auto" style="width: 10rem;">
                <div id="day3" class="card-header pink">
                    Day 3
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp3" class="list-group-item">Degrees</li>
                    <li class="list-group-item">
                        <img id="image3" src="" alt="">
                    </li>
                    <li id="description3" class="list-group-item">Weather</li>
                    <li id="humidity3" class="list-group-item">humidity</li>
                    <li id="wind3" class="list-group-item">wind</li>
                    <li id="pressure3" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card fixText m-auto" style="width: 10rem;">
                <div id="day4" class="card-header bgImage">
                    Day 4
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp4" class="list-group-item">Degrees</li>
                    <li class="list-group-item">
                        <img id="image4" src="" alt="">
                    </li>
                    <li id="description4" class="list-group-item">Weather</li>
                    <li id="humidity4" class="list-group-item">humidity</li>
                    <li id="wind4" class="list-group-item">wind</li>
                    <li id="pressure4" class="list-group-item">pressure</li>
                </ul>
            </div>

            <div class="card fixText m-auto" style="width: 10rem;">
                <div id="day5" class="card-header pink">
                    Day 5
                </div>
                <ul class="list-group list-group-flush">
                    <li id="temp5" class="list-group-item">Degrees</li>
                    <li class="list-group-item">
                        <img id="image5" src="" alt="">
                    </li>
                    <li id="description5" class="list-group-item">Weather</li>
                    <li id="humidity5" class="list-group-item">humidity</li>
                    <li id="wind5" class="list-group-item">wind</li>
                    <li id="pressure5" class="list-group-item">pressure</li>
                </ul>
            </div>

        </div>
        <hr>
        <!--    map-->
        <div class="container-fluid d-flex justify-content-evenly">
            <div class="row">
                <div class="col" style="width: 20rem;">
                    <input class="form-control" id="searchBar" placeholder="Enter Location">
                    <button id="btn" type="submit" class="btn pink">Submit</button>
                    <div style="width:100%;height:0;padding-bottom:57%;position:relative;margin-top:10px;">
                        <iframe src="https://giphy.com/embed/AFdcYElkoNAUE" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
                    </div>
                </div>
            </div>

            <div id="map" class="d-"></div>
        </div>
<!--        end-->
    </div>
</div>


<script src="js/key.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js'></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        //map
        mapboxgl.accessToken = MAPBOX_API_KEY;
        const map = new mapboxgl.Map({
            container: 'map',
            style: "mapbox://styles/mapbox/outdoors-v12",
            zoom: 10,
            center: [-98.4916, 29.4252],
        });


        $('#btn').click(function (e) {
            e.preventDefault()
            let search =  $("#searchBar")[0].value;
            pinThatAddress(search)
            // $('audio#wow')[0].play();
            // $('#searchBar')[0].value = ""
        });

        function pinThatAddress(address) {
            geocode(address, MAPBOX_API_KEY).then(function(result) {
                map.flyTo({
                    center: result,
                    essential: true
                });

                const marker = new mapboxgl.Marker({
                    "color": "#FFC0CB",
                })
                marker.setLngLat(result);
                marker.addTo(map);
                const popup = new mapboxgl.Popup();
                popup.setHTML(`<h3>${address}</h3>`);
                marker.setPopup(popup);
                getWeather(result[1], result[0]);
            }).catch(function(error) {
                console.log("Bam");
            });
        }


        function getCoordinates() {
            map.on('dblclick', (e) => {
                $('audio#wow')[0].play();
                let lat = e.lngLat.lat
                let lng = e.lngLat.lng
                let popup = new mapboxgl.Popup()
                    .setLngLat([lng, lat])
                    // .setHTML(`lat = ${lat} lng = ${lng}`)
                const marker = new mapboxgl.Marker({
                    "color": "#FFC0CB"
                })
                    .setLngLat([lng, lat])
                    .addTo(map);
                popup.addTo(map);
                getWeather(lat, lng)
            });
        }
        getCoordinates()


        function getDate(dt){
            let utcSeconds = dt
            let date = new Date(utcSeconds*1000);
            let resultFormat = date.toISOString().split('T')[0]
            return resultFormat;
        }

        function getIcon(id){
            if (id > 800 && id < 805) {
                //clouds
                return "http://openweathermap.org/img/w/04d.png";
            } else if (id > 499 && id < 532){
                //rain
                return "http://openweathermap.org/img/w/10d.png";
            } else if (id > 199 && id < 233) {
                //thunderstorm
                return "http://openweathermap.org/img/w/11d.png"
            }
            else if (id > 299 && id < 322) {
                //drizzle
                return "http://openweathermap.org/img/w/09d.png"
            }
            else if (id > 599 && id < 623) {
                //snow
                return "http://openweathermap.org/img/w/13d.png"
            }else if (id > 699 && id < 782) {
                //atmosphere
                return "http://openweathermap.org/img/w/50d.png"
            }else if (id === 800) {
                //clear
                return "http://openweathermap.org/img/w/01d.png"
            }
        }


        function getWeather(mylat, mylon) {
            $.get("http://api.openweathermap.org/data/2.5/forecast", {
                APPID: OPENWEATHER_API_KEY,
                lat: mylat,
                lon: mylon,
                units: "imperial"
            }).done(function (data) {
                console.log('The entire response:', data);
                console.log(data.length)
                let idCycle = 1
                for (let i = 0; i < data.list.length; i +=8 ) {
                    let formatedDate = getDate(data.list[i].dt)
                    $(`#day${idCycle}`).html(formatedDate);

                    let formatedIcon = getIcon(data.list[i].weather[0].id);
                    $(`#image${idCycle}`).attr("src", formatedIcon)

                    $(`#temp${idCycle}`).html(`Temp: ${data.list[i].main.temp}\xB0`)
                    $(`#description${idCycle}`).html(data.list[i].weather[0].main)
                    $(`#humidity${idCycle}`).html(`Humidity: ${data.list[i].main.humidity}`)
                    $(`#wind${idCycle}`).html(`Wind: ${data.list[i].wind.speed}`)
                    $(`#pressure${idCycle}`).html(`Pressure: ${data.list[i].main.pressure}`);
                    console.log(idCycle)
                    idCycle += 1
                }
            });
        }


    });
</script>

</body>
</html>